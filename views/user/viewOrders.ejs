
<!DOCTYPE html>
<html>
  <%- include('../partials/head.ejs') %>
  <body>
    <!-- nav bar -->
    <%- include('../partials/userNavBar.ejs') %>

    <div class="container">
<div class="d-flex">
    <div>
          <%- include('../partials/userSideBar.ejs') %>
    </div>
        <div class="page-content container">
          <section class="section">
            <div class="row" id="table-hover-row">
              <div class="col-12 mx-auto">
                <div class="card-content">
                     <div class="cart_title text-center">Previous Ordered Items</div>
                     <div id="allOrders" ></div>
                 </div>
             </div>
         </div>
     </div>
 </div>
 </div>
 
 <script>
      let navHilight = document.getElementById("orders");
      navHilight.classList.add("active");
  check()
      function check() {
        fetch(`/profile/orders`, {
          method: "GET",
        })
          .then(function (response) {
            return response.json();
          })
          .then((response) => {
            if (response.length != 0) {
              
              let orders = "";
              response.forEach((element, i) => {
                let temp;
                element.orderdItems.forEach((val, h) => {
                  temp += `
                      <tr>
                        <td scope="row">${val.name}</td>
                        <td scope="row">${element.orders[h].price||val.price}</td>
                        <td scope="row">${element.orders[h].quantity}</td>
                        <td scope="row">${element.orders[h].price * element.orders[h].quantity||val.price * element.orders[h].quantity}</td>
                        <td scope="row">
                          <img src="/images/${val._id}.jpg" alt="${
                    val.name
                  }"  style="width:50px; height:50px;" /></td>
                      </tr>
                `;
                });
                if (element.orders.length != 0) {
                  orders += `
              <div class="col-lg-12 grid-margin my-4">
              <div class="card">
                <div class="card-body">
                  <div class='row'>
                    <div class="col-md-6">
                  <h4 class="card-title">Address : ${element.address}</h4>
                  <h4 class="card-title">Payment Methd : ${element.payMethod}</h4>
                  <h4 class="card-title">Date : ${new Date(element.createdAt).toLocaleDateString()}</h4>
                  <h4 class="card-title">Total Price : ${element.totalPrice}</h4>
                    </div>
                    <div class="col-md-6">
                              ${
                                (function() {
                                  if(element.status=='deleverd'){
                                         return `<div scope="row " class='text-success font-weight-bolder'><a>Deleverd</a></div>`
                                 }else if(element.status=='cancelled'){
                                        return `<div scope="row"class='text-danger font-weight-bolder'><a>Canceled</a></div>`
                                 }else if(element.status=='shipped'){
                                        return `<div scope="row"class='text-danger font-weight-bolder'><a class='text-success'>Shipped</a></div>`
                                 }
                                 else {
                                     return`<div scope="row"><a onclick="cancel('${element._id}','${element.payMethod}','${element.totalPrice}')" class="btn btn-danger text-white">Cancel Order</a></div>`
                                 } 
                                })()
                              }
                    </div>
                  </div>
                    <table class="table table-hover mb-0 ">
                    <thead>
                      <tr>
                        <th scope="col">Product Name</th>
                        <th scope="col">Price</th>
                        <th scope="col">Quantyty</th>
                        <th scope="col">Total Price</th>
                        <th scope="col">Image</th>
                        <th scope="col"></th>
                      </tr>
                    </thead>
                    <tbody id="tableBody">
                      ${temp}
                    </tbody>
                  </table>
                </div>
              </div>
            </div> 
                `;
                }
              });
              document.getElementById("allOrders").innerHTML = orders;
            } else {
              document.getElementById("allOrders").innerHTML = `
            <h3>There is no orders</h3>
            `;
            }
          });
      }
      function cancel(orderId,payMethod,totalPrice) {
        console.log({orderId,payMethod,totalPrice})
        let cancelProduct = confirm("are you sure you want to cancel this product?");
        if (cancelProduct) {
           fetch(`/profile/cancelOrder?orderId=${orderId}&payMethod=${payMethod}&totalPrice=${totalPrice}`)
           .then(response => {
            check()
           }) 
        }
      }
 </script>
<style>
    *{margin: 0;padding: 0;-webkit-font-smoothing: antialiased;-webkit-text-shadow: rgba(0,0,0,.01) 0 0 1px;text-shadow: rgba(0,0,0,.01) 0 0 1px}body{font-family: 'Rubik', sans-serif;font-size: 14px;font-weight: 400;background: #E0E0E0;color: #000000}ul{list-style: none;margin-bottom: 0px}.button{display: inline-block;background: #0e8ce4;border-radius: 5px;height: 48px;-webkit-transition: all 200ms ease;-moz-transition: all 200ms ease;-ms-transition: all 200ms ease;-o-transition: all 200ms ease;transition: all 200ms ease}.button a{display: block;font-size: 18px;font-weight: 400;line-height: 48px;color: #FFFFFF;padding-left: 35px;padding-right: 35px}.button:hover{opacity: 0.8}.cart_section{width: 100%;padding-top: 93px;padding-bottom: 111px}.cart_title{font-size: 30px;font-weight: 500}.cart_items{margin-top: 8px}.cart_list{border: solid 1px #e8e8e8;box-shadow: 0px 1px 5px rgba(0,0,0,0.1);background-color: #fff}.cart_item{width: 100%;padding: 15px;padding-right: 46px}.cart_item_image{width: 133px;height: 133px;float: left}.cart_item_image img{max-width: 100%}.cart_item_info{width: calc(100% - 133px);float: left;padding-top: 18px}.cart_item_name{margin-left: 7.53%}.cart_item_title{font-size: 14px;font-weight: 400;color: rgba(0,0,0,0.5)}.cart_item_text{font-size: 18px;margin-top: 35px}.cart_item_text span{display: inline-block;width: 20px;height: 20px;border-radius: 50%;margin-right: 11px;-webkit-transform: translateY(4px);-moz-transform: translateY(4px);-ms-transform: translateY(4px);-o-transform: translateY(4px);transform: translateY(4px)}.cart_item_price{text-align: right}.cart_item_total{text-align: right}.order_total{width: 100%;height: 60px;margin-top: 30px;border: solid 1px #e8e8e8;box-shadow: 0px 1px 5px rgba(0,0,0,0.1);padding-right: 46px;padding-left: 15px;background-color: #fff}.order_total_title{display: inline-block;font-size: 14px;color: rgba(0,0,0,0.5);line-height: 60px}.order_total_amount{display: inline-block;font-size: 18px;font-weight: 500;margin-left: 26px;line-height: 60px}.cart_buttons{margin-top: 60px;text-align: right}.cart_button_clear{display: inline-block;border: none;font-size: 18px;font-weight: 400;line-height: 48px;color: rgba(0,0,0,0.5);background: #FFFFFF;border: solid 1px #b2b2b2;padding-left: 35px;padding-right: 35px;outline: none;cursor: pointer;margin-right: 26px}.cart_button_clear:hover{border-color: #0e8ce4;color: #0e8ce4}.cart_button_checkout{display: inline-block;border: none;font-size: 18px;font-weight: 400;line-height: 48px;color: #FFFFFF;padding-left: 35px;padding-right: 35px;outline: none;cursor: pointer;vertical-align: top}
</style>
<style>
      .gradient-custom {
        /* fallback for old browsers */
        background: #6a11cb;

        /* Chrome 10-25, Safari 5.1-6 */
        background: -webkit-linear-gradient(
          to right,
          rgba(106, 17, 203, 1),
          rgba(37, 117, 252, 1)
        );

        /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        background: linear-gradient(
          to right,
          rgba(106, 17, 203, 1),
          rgba(37, 117, 252, 1)
        );
      }
      body {
        font-size: 16px;
        color: #6f6f6f;
        font-weight: 400;
        line-height: 28px;
        letter-spacing: 0.8px;
        margin-top: 20px;
      }
      .font-size38 {
        font-size: 38px;
      }
      .team-single-text .section-heading h4,
      .section-heading h5 {
        font-size: 36px;
      }

      .team-single-text .section-heading.half {
        margin-bottom: 20px;
      }

      @media screen and (max-width: 1199px) {
        .team-single-text .section-heading h4,
        .section-heading h5 {
          font-size: 32px;
        }
        .team-single-text .section-heading.half {
          margin-bottom: 15px;
        }
      }

      @media screen and (max-width: 991px) {
        .team-single-text .section-heading h4,
        .section-heading h5 {
          font-size: 28px;
        }
        .team-single-text .section-heading.half {
          margin-bottom: 10px;
        }
      }

      @media screen and (max-width: 767px) {
        .team-single-text .section-heading h4,
        .section-heading h5 {
          font-size: 24px;
        }
      }

      .team-single-icons ul li {
        display: inline-block;
        border: 1px solid #02c2c7;
        border-radius: 50%;
        color: #86bc42;
        margin-right: 8px;
        margin-bottom: 5px;
        -webkit-transition-duration: 0.3s;
        transition-duration: 0.3s;
      }

      .team-single-icons ul li a {
        color: #02c2c7;
        display: block;
        font-size: 14px;
        height: 25px;
        line-height: 26px;
        text-align: center;
        width: 25px;
      }

      .team-single-icons ul li:hover {
        background: #02c2c7;
        border-color: #02c2c7;
      }

      .team-single-icons ul li:hover a {
        color: #fff;
      }

      .team-social-icon li {
        display: inline-block;
        margin-right: 5px;
      }

      .team-social-icon li:last-child {
        margin-right: 0;
      }

      .team-social-icon i {
        width: 30px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        font-size: 15px;
        border-radius: 50px;
      }

      .padding-30px-all {
        padding: 30px;
      }
      .bg-light-gray {
        background-color: #f7f7f7;
      }
      .text-center {
        text-align: center !important;
      }
      img {
        max-width: 100%;
        height: auto;
      }

      .list-style9 {
        list-style: none;
        padding: 0;
      }

      .list-style9 li {
        position: relative;
        padding: 0 0 15px 0;
        margin: 0 0 15px 0;
        border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
      }

      .list-style9 li:last-child {
        border-bottom: none;
        padding-bottom: 0;
        margin-bottom: 0;
      }

      .text-sky {
        color: #02c2c7;
      }

      .text-orange {
        color: #e95601;
      }

      .text-green {
        color: #5bbd2a;
      }

      .text-yellow {
        color: #f0d001;
      }

      .text-pink {
        color: #ff48a4;
      }

      .text-purple {
        color: #9d60ff;
      }

      .text-lightred {
        color: #ff5722;
      }

      a.text-sky:hover {
        opacity: 0.8;
        color: #02c2c7;
      }

      a.text-orange:hover {
        opacity: 0.8;
        color: #e95601;
      }

      a.text-green:hover {
        opacity: 0.8;
        color: #5bbd2a;
      }

      a.text-yellow:hover {
        opacity: 0.8;
        color: #f0d001;
      }

      a.text-pink:hover {
        opacity: 0.8;
        color: #ff48a4;
      }

      a.text-purple:hover {
        opacity: 0.8;
        color: #9d60ff;
      }

      a.text-lightred:hover {
        opacity: 0.8;
        color: #ff5722;
      }

      .custom-progress {
        height: 10px;
        border-radius: 50px;
        box-shadow: none;
        margin-bottom: 25px;
      }
      .progress {
        display: -ms-flexbox;
        display: flex;
        height: 1rem;
        overflow: hidden;
        font-size: 0.75rem;
        background-color: #e9ecef;
        border-radius: 0.25rem;
      }

      .bg-sky {
        background-color: #02c2c7;
      }

      .bg-orange {
        background-color: #e95601;
      }

      .bg-green {
        background-color: #5bbd2a;
      }

      .bg-yellow {
        background-color: #f0d001;
      }

      .bg-pink {
        background-color: #ff48a4;
      }

      .bg-purple {
        background-color: #9d60ff;
      }

      .bg-lightred {
        background-color: #ff5722;
      }
    </style>
  </body>
</html>
